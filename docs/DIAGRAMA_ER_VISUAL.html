<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagrama ER - Sistema Finanza</title>
    <script src="https://unpkg.com/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        .diagram-container {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }
        .legend {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .legend h3 {
            color: #34495e;
            margin-top: 0;
        }
        .legend-item {
            display: inline-block;
            margin: 5px 10px;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
        }
        .entity { background: #e3f2fd; border: 2px solid #1976d2; }
        .relationship { background: #e8f5e8; border: 2px solid #2e7d32; }
        .attribute { background: #fff8e1; border: 2px solid #f9a825; }
        .sync { background: #f3e5f5; border: 2px solid #7b1fa2; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üóÑÔ∏è Diagrama ER (Entidade-Relacionamento) - Sistema Finanza</h1>
        <p><strong>Modelo de Banco de Dados MySQL - Mobile (Android) + Desktop (Java)</strong></p>
        
        <div class="diagram-container">
            <div class="mermaid">
erDiagram
    %% Entidade Usuario
    USUARIO {
        string uuid PK "UUID √∫nico do usu√°rio"
        string nome "Nome completo"
        string email UK "Email √∫nico para login"
        string senha_hash "Senha criptografada SHA-256"
        datetime data_criacao "Data de cria√ß√£o da conta"
        datetime ultimo_login "√öltimo acesso ao sistema"
        boolean ativo "Status da conta (ativo/inativo)"
        text configuracoes "Configura√ß√µes JSON do usu√°rio"
        datetime data_modificacao "√öltima modifica√ß√£o dos dados"
        int versao "Controle de vers√£o para sync"
    }
    
    %% Entidade Conta
    CONTA {
        string uuid PK "UUID √∫nico da conta"
        string nome "Nome da conta (ex: Conta Corrente)"
        string tipo "Tipo da conta (CORRENTE, POUPANCA, CARTAO, DINHEIRO)"
        decimal saldo "Saldo atual da conta"
        string banco "Nome do banco/institui√ß√£o"
        string agencia "N√∫mero da ag√™ncia"
        string numero "N√∫mero da conta"
        boolean ativa "Status da conta (ativa/inativa)"
        datetime data_criacao "Data de cria√ß√£o da conta"
        datetime data_modificacao "√öltima modifica√ß√£o"
        int versao "Controle de vers√£o para sync"
        string uuid_usuario FK "Refer√™ncia ao usu√°rio propriet√°rio"
    }
    
    %% Entidade Categoria
    CATEGORIA {
        string uuid PK "UUID √∫nico da categoria"
        string nome "Nome da categoria (ex: Alimenta√ß√£o)"
        string tipo "Tipo (RECEITA, DESPESA)"
        string cor "C√≥digo hexadecimal da cor"
        string icone "Nome do √≠cone para UI"
        boolean ativa "Status da categoria (ativa/inativa)"
        datetime data_criacao "Data de cria√ß√£o da categoria"
        datetime data_modificacao "√öltima modifica√ß√£o"
        int versao "Controle de vers√£o para sync"
        string uuid_usuario FK "Refer√™ncia ao usu√°rio propriet√°rio"
    }
    
    %% Entidade Transacao
    TRANSACAO {
        string uuid PK "UUID √∫nico da transa√ß√£o"
        decimal valor "Valor da transa√ß√£o (positivo/negativo)"
        string descricao "Descri√ß√£o da transa√ß√£o"
        date data "Data da transa√ß√£o"
        string tipo "Tipo (RECEITA, DESPESA, TRANSFERENCIA)"
        string status "Status (CONFIRMADA, PENDENTE, CANCELADA)"
        text observacoes "Observa√ß√µes adicionais"
        datetime data_criacao "Data de cria√ß√£o do registro"
        datetime data_modificacao "√öltima modifica√ß√£o"
        int versao "Controle de vers√£o para sync"
        string uuid_conta FK "Refer√™ncia √† conta origem"
        string uuid_categoria FK "Refer√™ncia √† categoria"
        string uuid_usuario FK "Refer√™ncia ao usu√°rio"
        string uuid_conta_destino FK "Para transfer√™ncias (opcional)"
    }
    
    %% Entidade SyncData
    SYNC_DATA {
        string uuid PK "UUID √∫nico do registro de sync"
        string tipo_entidade "Tipo da entidade (USUARIO, CONTA, CATEGORIA, TRANSACAO)"
        string uuid_entidade "UUID da entidade modificada"
        string acao "A√ß√£o realizada (CREATE, UPDATE, DELETE)"
        datetime timestamp "Momento da modifica√ß√£o"
        text dados_json "Dados completos da entidade em JSON"
        boolean sincronizado "Status de sincroniza√ß√£o"
        datetime data_sincronizacao "Quando foi sincronizado"
        string uuid_usuario FK "Refer√™ncia ao usu√°rio"
    }
    
    %% Entidade ConflictResolution
    CONFLICT_RESOLUTION {
        string uuid PK "UUID √∫nico do conflito"
        string tipo_conflito "Tipo (UPDATE_CONFLICT, DELETE_CONFLICT, CREATE_CONFLICT)"
        string uuid_entidade "UUID da entidade em conflito"
        text dados_servidor "Dados da vers√£o do servidor"
        text dados_cliente "Dados da vers√£o do cliente"
        string resolucao "Estrat√©gia de resolu√ß√£o aplicada"
        datetime timestamp_conflito "Quando o conflito foi detectado"
        datetime timestamp_resolucao "Quando foi resolvido"
        boolean resolvido "Status de resolu√ß√£o"
        string uuid_usuario FK "Refer√™ncia ao usu√°rio"
    }
    
    %% Entidade Relatorio
    RELATORIO {
        string uuid PK "UUID √∫nico do relat√≥rio"
        string tipo "Tipo (MENSAL, ANUAL, PERSONALIZADO, CATEGORIA)"
        string titulo "T√≠tulo do relat√≥rio"
        date data_inicio "Data inicial do per√≠odo"
        date data_fim "Data final do per√≠odo"
        text parametros "Par√¢metros de filtro em JSON"
        string formato "Formato de sa√≠da (PDF, CSV, EXCEL, HTML)"
        datetime data_geracao "Quando foi gerado"
        string caminho_arquivo "Caminho do arquivo gerado"
        boolean ativo "Status do relat√≥rio"
        string uuid_usuario FK "Refer√™ncia ao usu√°rio"
    }
    
    %% Entidade Session
    SESSION {
        string uuid PK "UUID √∫nico da sess√£o"
        string token "Token de autentica√ß√£o"
        datetime data_criacao "In√≠cio da sess√£o"
        datetime data_expiracao "Expira√ß√£o da sess√£o"
        string ip_address "IP do cliente"
        string user_agent "Navegador/app utilizado"
        boolean ativa "Status da sess√£o"
        datetime ultimo_acesso "√öltimo acesso da sess√£o"
        string uuid_usuario FK "Refer√™ncia ao usu√°rio"
    }
    
    %% Entidade AuditLog
    AUDIT_LOG {
        string uuid PK "UUID √∫nico do log"
        string acao "A√ß√£o realizada"
        string entidade "Entidade afetada"
        string uuid_entidade "UUID da entidade"
        text dados_anteriores "Estado antes da modifica√ß√£o"
        text dados_novos "Estado depois da modifica√ß√£o"
        datetime timestamp "Momento da a√ß√£o"
        string ip_address "IP do cliente"
        string user_agent "Navegador/app utilizado"
        string uuid_usuario FK "Usu√°rio que realizou a a√ß√£o"
    }
    
    %% Entidade Backup
    BACKUP {
        string uuid PK "UUID √∫nico do backup"
        string tipo "Tipo (AUTOMATICO, MANUAL, INCREMENTAL)"
        datetime data_criacao "Data da cria√ß√£o do backup"
        string caminho_arquivo "Local do arquivo de backup"
        long tamanho_bytes "Tamanho do arquivo em bytes"
        string checksum "Hash MD5 para verifica√ß√£o"
        boolean comprimido "Se est√° comprimido"
        string status "Status (EM_ANDAMENTO, CONCLUIDO, ERRO)"
        text observacoes "Observa√ß√µes sobre o backup"
    }
    
    %% Relacionamentos
    USUARIO ||--o{ CONTA : "possui"
    USUARIO ||--o{ CATEGORIA : "cria"
    USUARIO ||--o{ TRANSACAO : "realiza"
    USUARIO ||--o{ SYNC_DATA : "gera"
    USUARIO ||--o{ CONFLICT_RESOLUTION : "possui"
    USUARIO ||--o{ RELATORIO : "solicita"
    USUARIO ||--o{ SESSION : "inicia"
    USUARIO ||--o{ AUDIT_LOG : "executa"
    
    CONTA ||--o{ TRANSACAO : "cont√©m"
    CATEGORIA ||--o{ TRANSACAO : "classifica"
    
    TRANSACAO ||--o{ SYNC_DATA : "gera dados sync"
    CONTA ||--o{ SYNC_DATA : "gera dados sync"
    CATEGORIA ||--o{ SYNC_DATA : "gera dados sync"
    USUARIO ||--o{ SYNC_DATA : "gera dados sync"
    
    CONTA ||--o{ TRANSACAO : "destino (transfer√™ncia)"
            </div>
        </div>
        
        <div class="legend">
            <h3>üé® Legenda do Diagrama ER:</h3>
            <div class="legend-item entity">üîµ Entidades do Sistema</div>
            <div class="legend-item relationship">üü¢ Relacionamentos</div>
            <div class="legend-item attribute">üü° Atributos/Campos</div>
            <div class="legend-item sync">üü£ Controle de Sincroniza√ß√£o</div>
        </div>
        
        <div class="legend">
            <h3>üìä Estat√≠sticas do Banco de Dados:</h3>
            <ul>
                <li><strong>Total de Entidades:</strong> 10</li>
                <li><strong>Entidades Principais:</strong> 4 (USUARIO, CONTA, CATEGORIA, TRANSACAO)</li>
                <li><strong>Entidades de Controle:</strong> 6 (SYNC_DATA, CONFLICT_RESOLUTION, RELATORIO, SESSION, AUDIT_LOG, BACKUP)</li>
                <li><strong>Relacionamentos:</strong> 14 associa√ß√µes diretas</li>
                <li><strong>Chaves Estrangeiras:</strong> 15 FKs para integridade referencial</li>
            </ul>
        </div>
        
        <div class="legend">
            <h3>üîß Recursos de Banco de Dados:</h3>
            <ul>
                <li><strong>UUID:</strong> Chaves prim√°rias universais para distribui√ß√£o</li>
                <li><strong>Versionamento:</strong> Campo "versao" para controle de concorr√™ncia</li>
                <li><strong>Auditoria:</strong> Timestamps autom√°ticos e logs de mudan√ßas</li>
                <li><strong>Sincroniza√ß√£o:</strong> Controle completo de dados offline/online</li>
                <li><strong>Integridade:</strong> Chaves estrangeiras e restri√ß√µes de dom√≠nio</li>
                <li><strong>Backup:</strong> Sistema automatizado de backup e restore</li>
            </ul>
        </div>
        
        <div class="legend">
            <h3>üìù Observa√ß√µes T√©cnicas:</h3>
            <ul>
                <li>Modelo segue padr√µes de normaliza√ß√£o de banco de dados (3NF)</li>
                <li>Suporte completo a sincroniza√ß√£o distribu√≠da entre mobile e desktop</li>
                <li>Otimizado para consultas frequentes do sistema financeiro</li>
                <li>Integridade referencial totalmente implementada com cascading</li>
                <li>Preparado para horizontal scaling com UUID como PK</li>
            </ul>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            er: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
    </script>
</body>
</html>