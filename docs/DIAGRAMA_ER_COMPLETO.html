<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagrama ER - Sistema Finanza</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        .diagram-visual {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 30px;
            margin: 20px 0;
            min-height: 1200px;
            overflow-x: auto;
        }
        .visual-diagram {
            font-family: 'Courier New', monospace;
            line-height: 1.4;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            white-space: pre-wrap;
            overflow-x: auto;
            font-size: 10px;
        }
        .legend {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .legend h3 {
            color: #34495e;
            margin-top: 0;
        }
        .legend-item {
            display: inline-block;
            margin: 5px 10px;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            border: 2px solid;
        }
        .entity { background: #e3f2fd; border-color: #1976d2; }
        .relationship { background: #e8f5e8; border-color: #2e7d32; }
        .attribute { background: #fff8e1; border-color: #f9a825; }
        .sync { background: #f3e5f5; border-color: #7b1fa2; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🗄️ Diagrama ER (Entidade-Relacionamento) - Sistema Finanza</h1>
        <p><strong>Modelo de Banco de Dados MySQL - Mobile (Android) + Desktop (Java)</strong></p>
        
        <div class="diagram-visual">
            <div class="visual-diagram">
╔═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                                                                                        SISTEMA FINANZA - DIAGRAMA ENTIDADE-RELACIONAMENTO (ER)                                                                                                       ║
╚═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                           ENTIDADES PRINCIPAIS DO DOMÍNIO                                                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────┐        ┌──────────────────────────────────────────┐        ┌──────────────────────────────────────────┐        ┌──────────────────────────────────────────┐
│                USUARIO                   │        │                 CONTA                    │        │               CATEGORIA                  │        │               TRANSACAO                  │
├──────────────────────────────────────────┤        ├──────────────────────────────────────────┤        ├──────────────────────────────────────────┤        ├──────────────────────────────────────────┤
│ uuid (PK)            │ VARCHAR(36)       │        │ uuid (PK)            │ VARCHAR(36)       │        │ uuid (PK)            │ VARCHAR(36)       │        │ uuid (PK)            │ VARCHAR(36)       │
│ nome                 │ VARCHAR(100)      │        │ nome                 │ VARCHAR(100)      │        │ nome                 │ VARCHAR(100)      │        │ valor                │ DECIMAL(15,2)     │
│ email (UK)           │ VARCHAR(100)      │        │ tipo                 │ ENUM(...)         │        │ tipo                 │ ENUM(...)         │        │ descricao            │ VARCHAR(255)      │
│ senha_hash           │ VARCHAR(255)      │        │ saldo                │ DECIMAL(15,2)     │        │ cor                  │ VARCHAR(7)        │        │ data                 │ DATE              │
│ data_criacao         │ DATETIME          │        │ banco                │ VARCHAR(100)      │        │ icone                │ VARCHAR(50)       │        │ tipo                 │ ENUM(...)         │
│ ultimo_login         │ DATETIME          │        │ agencia              │ VARCHAR(20)       │        │ ativa                │ BOOLEAN           │        │ status               │ ENUM(...)         │
│ ativo                │ BOOLEAN           │        │ numero               │ VARCHAR(30)       │        │ data_criacao         │ DATETIME          │        │ observacoes          │ TEXT              │
│ configuracoes        │ TEXT              │        │ ativa                │ BOOLEAN           │        │ data_modificacao     │ DATETIME          │        │ data_criacao         │ DATETIME          │
│ data_modificacao     │ DATETIME          │        │ data_criacao         │ DATETIME          │        │ versao               │ INT               │        │ data_modificacao     │ DATETIME          │
│ versao               │ INT               │        │ data_modificacao     │ DATETIME          │        │ uuid_usuario (FK)    │ VARCHAR(36) ──────┼────────│ versao               │ INT               │
└──────────────────────────────────────────┘        │ versao               │ INT               │        └──────────────────────────────────────────┘        │ uuid_conta (FK)      │ VARCHAR(36) ──────┼────────
           │                                        │ uuid_usuario (FK)    │ VARCHAR(36) ──────┼──────────────────────────────────────────────────────────────────────│ uuid_categoria (FK)  │ VARCHAR(36) ──────┼────────
           │                                        └──────────────────────────────────────────┘                                                                         │ uuid_usuario (FK)    │ VARCHAR(36) ──────┼────────
           │                                                   │                                                                                                           │ uuid_conta_destino   │ VARCHAR(36)       │
           │                                                   │                                                                                                           └──────────────────────────────────────────┘
           │ 1                                                 │ 1                                                           ▲                                                      │ *
           │                                                   │                                                             │ 1                                                    │
           │ possui                                            │ registra                                                    │ classifica                                           │
           ▼ *                                                 ▼ *                                                           │ *                                                    │
     ┌─────────────┐                                    ┌─────────────┐                                               ┌─────────────┐                                             │
     │   POSSUI    │                                    │  REGISTRA   │                                               │ CLASSIFICA  │                                             │
     └─────────────┘                                    └─────────────┘                                               └─────────────┘                                             │
           │                                                   │                                                             │                                                     │
           │                                                   │                                                             │                                                     │
           ▼                                                   ▼                                                             ▼                                                     │
                                                         ┌─────────────┐                                                                                                         │
                                                         │  REALIZA    │◄────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                         └─────────────┘
                                                               │ 1
                                                               │ realiza
                                                               ▼ *

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                    ENTIDADES DE CONTROLE E SINCRONIZAÇÃO                                                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────┐        ┌──────────────────────────────────────────┐        ┌──────────────────────────────────────────┐        ┌──────────────────────────────────────────┐
│              SYNC_DATA                   │        │          CONFLICT_RESOLUTION             │        │               RELATORIO                  │        │               SESSION                    │
├──────────────────────────────────────────┤        ├──────────────────────────────────────────┤        ├──────────────────────────────────────────┤        ├──────────────────────────────────────────┤
│ uuid (PK)            │ VARCHAR(36)       │        │ uuid (PK)            │ VARCHAR(36)       │        │ uuid (PK)            │ VARCHAR(36)       │        │ uuid (PK)            │ VARCHAR(36)       │
│ tipo_entidade        │ VARCHAR(50)       │        │ tipo_conflito        │ VARCHAR(50)       │        │ tipo                 │ VARCHAR(50)       │        │ token                │ VARCHAR(255)      │
│ uuid_entidade        │ VARCHAR(36)       │        │ uuid_entidade        │ VARCHAR(36)       │        │ titulo               │ VARCHAR(200)      │        │ data_criacao         │ DATETIME          │
│ acao                 │ VARCHAR(20)       │        │ dados_servidor       │ TEXT              │        │ data_inicio          │ DATE              │        │ data_expiracao       │ DATETIME          │
│ timestamp            │ DATETIME          │        │ dados_cliente        │ TEXT              │        │ data_fim             │ DATE              │        │ ip_address           │ VARCHAR(45)       │
│ dados_json           │ TEXT              │        │ resolucao            │ VARCHAR(50)       │        │ parametros           │ TEXT              │        │ user_agent           │ VARCHAR(255)      │
│ sincronizado         │ BOOLEAN           │        │ timestamp_conflito   │ DATETIME          │        │ formato              │ VARCHAR(20)       │        │ ativa                │ BOOLEAN           │
│ data_sincronizacao   │ DATETIME          │        │ timestamp_resolucao  │ DATETIME          │        │ data_geracao         │ DATETIME          │        │ ultimo_acesso        │ DATETIME          │
│ uuid_usuario (FK)    │ VARCHAR(36) ──────┼────────│ resolvido            │ BOOLEAN           │        │ caminho_arquivo      │ VARCHAR(500)      │        │ uuid_usuario (FK)    │ VARCHAR(36) ──────┼────────
└──────────────────────────────────────────┘        │ uuid_usuario (FK)    │ VARCHAR(36) ──────┼────────│ ativo                │ BOOLEAN           │        └──────────────────────────────────────────┘
                                                     └──────────────────────────────────────────┘        │ uuid_usuario (FK)    │ VARCHAR(36) ──────┼────────
                                                                                                           └──────────────────────────────────────────┘

┌──────────────────────────────────────────┐        ┌──────────────────────────────────────────┐
│              AUDIT_LOG                   │        │                BACKUP                    │
├──────────────────────────────────────────┤        ├──────────────────────────────────────────┤
│ uuid (PK)            │ VARCHAR(36)       │        │ uuid (PK)            │ VARCHAR(36)       │
│ acao                 │ VARCHAR(100)      │        │ tipo                 │ VARCHAR(50)       │
│ entidade             │ VARCHAR(50)       │        │ data_criacao         │ DATETIME          │
│ uuid_entidade        │ VARCHAR(36)       │        │ caminho_arquivo      │ VARCHAR(500)      │
│ dados_anteriores     │ TEXT              │        │ tamanho_bytes        │ BIGINT            │
│ dados_novos          │ TEXT              │        │ checksum             │ VARCHAR(32)       │
│ timestamp            │ DATETIME          │        │ comprimido           │ BOOLEAN           │
│ ip_address           │ VARCHAR(45)       │        │ status               │ VARCHAR(30)       │
│ user_agent           │ VARCHAR(255)      │        │ observacoes          │ TEXT              │
│ uuid_usuario (FK)    │ VARCHAR(36) ──────┼────────└──────────────────────────────────────────┘
└──────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                      RELACIONAMENTOS PRINCIPAIS                                                                                                                             │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

╔══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║  CARDINALIDADES E RELACIONAMENTOS:                                                                                                                                                                                                                                         ║
║                                                                                                                                                                                                                                                                             ║
║  ┌─────────────────┐  1      *  ┌─────────────────┐                                                                                                                                                                                                                       ║
║  │     USUARIO     │ ◄─────────► │      CONTA      │  (Um usuário possui várias contas)                                                                                                                                                                                    ║
║  └─────────────────┘            └─────────────────┘                                                                                                                                                                                                                       ║
║                                                                                                                                                                                                                                                                             ║
║  ┌─────────────────┐  1      *  ┌─────────────────┐                                                                                                                                                                                                                       ║
║  │     USUARIO     │ ◄─────────► │   CATEGORIA     │  (Um usuário cria várias categorias)                                                                                                                                                                                  ║
║  └─────────────────┘            └─────────────────┘                                                                                                                                                                                                                       ║
║                                                                                                                                                                                                                                                                             ║
║  ┌─────────────────┐  1      *  ┌─────────────────┐                                                                                                                                                                                                                       ║
║  │     USUARIO     │ ◄─────────► │   TRANSACAO     │  (Um usuário realiza várias transações)                                                                                                                                                                               ║
║  └─────────────────┘            └─────────────────┘                                                                                                                                                                                                                       ║
║                                                                                                                                                                                                                                                                             ║
║  ┌─────────────────┐  1      *  ┌─────────────────┐                                                                                                                                                                                                                       ║
║  │      CONTA      │ ◄─────────► │   TRANSACAO     │  (Uma conta contém várias transações)                                                                                                                                                                                 ║
║  └─────────────────┘            └─────────────────┘                                                                                                                                                                                                                       ║
║                                                                                                                                                                                                                                                                             ║
║  ┌─────────────────┐  1      *  ┌─────────────────┐                                                                                                                                                                                                                       ║
║  │   CATEGORIA     │ ◄─────────► │   TRANSACAO     │  (Uma categoria classifica várias transações)                                                                                                                                                                         ║
║  └─────────────────┘            └─────────────────┘                                                                                                                                                                                                                       ║
║                                                                                                                                                                                                                                                                             ║
║  ┌─────────────────┐  1      *  ┌─────────────────┐                                                                                                                                                                                                                       ║
║  │     USUARIO     │ ◄─────────► │   SYNC_DATA     │  (Um usuário gera vários registros de sincronização)                                                                                                                                                                  ║
║  └─────────────────┘            └─────────────────┘                                                                                                                                                                                                                       ║
║                                                                                                                                                                                                                                                                             ║
║  ┌─────────────────┐  1      *  ┌─────────────────┐                                                                                                                                                                                                                       ║
║  │     USUARIO     │ ◄─────────► │CONFLICT_RESOLUT │  (Um usuário possui vários conflitos de sincronização)                                                                                                                                                                ║
║  └─────────────────┘            └─────────────────┘                                                                                                                                                                                                                       ║
║                                                                                                                                                                                                                                                                             ║
║  ┌─────────────────┐  1      *  ┌─────────────────┐                                                                                                                                                                                                                       ║
║  │     USUARIO     │ ◄─────────► │   RELATORIO     │  (Um usuário solicita vários relatórios)                                                                                                                                                                              ║
║  └─────────────────┘            └─────────────────┘                                                                                                                                                                                                                       ║
║                                                                                                                                                                                                                                                                             ║
║  ┌─────────────────┐  1      *  ┌─────────────────┐                                                                                                                                                                                                                       ║
║  │     USUARIO     │ ◄─────────► │    SESSION      │  (Um usuário inicia várias sessões)                                                                                                                                                                                   ║
║  └─────────────────┘            └─────────────────┘                                                                                                                                                                                                                       ║
║                                                                                                                                                                                                                                                                             ║
║  ┌─────────────────┐  1      *  ┌─────────────────┐                                                                                                                                                                                                                       ║
║  │     USUARIO     │ ◄─────────► │   AUDIT_LOG     │  (Um usuário executa várias ações auditadas)                                                                                                                                                                          ║
║  └─────────────────┘            └─────────────────┘                                                                                                                                                                                                                       ║
║                                                                                                                                                                                                                                                                             ║
║  RELACIONAMENTO ESPECIAL (Transferências):                                                                                                                                                                                                                                 ║
║  ┌─────────────────┐  0..1    * ┌─────────────────┐                                                                                                                                                                                                                       ║
║  │      CONTA      │ ◄─────────► │   TRANSACAO     │  (Uma conta pode ser destino de transferências)                                                                                                                                                                       ║
║  │   (destino)     │            │(uuid_conta_dest)│                                                                                                                                                                                                                       ║
║  └─────────────────┘            └─────────────────┘                                                                                                                                                                                                                       ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                      ÍNDICES E RESTRIÇÕES                                                                                                                             │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

CHAVES PRIMÁRIAS (PK):
• USUARIO.uuid          • CONTA.uuid            • CATEGORIA.uuid        • TRANSACAO.uuid
• SYNC_DATA.uuid        • CONFLICT_RESOLUTION.uuid   • RELATORIO.uuid        • SESSION.uuid
• AUDIT_LOG.uuid        • BACKUP.uuid

CHAVES ÚNICAS (UK):
• USUARIO.email         • SESSION.token

CHAVES ESTRANGEIRAS (FK):
• CONTA.uuid_usuario → USUARIO.uuid
• CATEGORIA.uuid_usuario → USUARIO.uuid
• TRANSACAO.uuid_conta → CONTA.uuid
• TRANSACAO.uuid_categoria → CATEGORIA.uuid
• TRANSACAO.uuid_usuario → USUARIO.uuid
• TRANSACAO.uuid_conta_destino → CONTA.uuid (opcional, para transferências)
• SYNC_DATA.uuid_usuario → USUARIO.uuid
• CONFLICT_RESOLUTION.uuid_usuario → USUARIO.uuid
• RELATORIO.uuid_usuario → USUARIO.uuid
• SESSION.uuid_usuario → USUARIO.uuid
• AUDIT_LOG.uuid_usuario → USUARIO.uuid

ÍNDICES DE PERFORMANCE:
• idx_usuario_email (USUARIO.email)
• idx_conta_usuario (CONTA.uuid_usuario)
• idx_categoria_usuario (CATEGORIA.uuid_usuario)
• idx_transacao_conta (TRANSACAO.uuid_conta)
• idx_transacao_categoria (TRANSACAO.uuid_categoria)
• idx_transacao_data (TRANSACAO.data)
• idx_sync_data_usuario (SYNC_DATA.uuid_usuario)
• idx_session_token (SESSION.token)
• idx_audit_timestamp (AUDIT_LOG.timestamp)

RESTRIÇÕES CHECK:
• TRANSACAO.valor <> 0
• TRANSACAO.data <= CURRENT_DATE
• CONTA.saldo >= 0 (para contas que não permitem saldo negativo)
• SESSION.data_expiracao > data_criacao
• BACKUP.tamanho_bytes > 0
            </div>
        </div>
        
        <div class="legend">
            <h3>🎨 Legenda do Diagrama ER:</h3>
            <div class="legend-item entity">🔵 Entidades do Sistema</div>
            <div class="legend-item relationship">🟢 Relacionamentos</div>
            <div class="legend-item attribute">🟡 Atributos/Campos</div>
            <div class="legend-item sync">🟣 Controle de Sincronização</div>
        </div>
        
        <div class="legend">
            <h3>📊 Estatísticas do Banco de Dados:</h3>
            <ul>
                <li><strong>Total de Entidades:</strong> 10</li>
                <li><strong>Entidades Principais:</strong> 4 (USUARIO, CONTA, CATEGORIA, TRANSACAO)</li>
                <li><strong>Entidades de Controle:</strong> 6 (SYNC_DATA, CONFLICT_RESOLUTION, RELATORIO, SESSION, AUDIT_LOG, BACKUP)</li>
                <li><strong>Relacionamentos:</strong> 14 associações diretas</li>
                <li><strong>Chaves Estrangeiras:</strong> 15 FKs para integridade referencial</li>
            </ul>
        </div>
        
        <div class="legend">
            <h3>🔧 Recursos de Banco de Dados:</h3>
            <ul>
                <li><strong>UUID:</strong> Chaves primárias universais para distribuição</li>
                <li><strong>Versionamento:</strong> Campo "versao" para controle de concorrência</li>
                <li><strong>Auditoria:</strong> Timestamps automáticos e logs de mudanças</li>
                <li><strong>Sincronização:</strong> Controle completo de dados offline/online</li>
                <li><strong>Integridade:</strong> Chaves estrangeiras e restrições de domínio</li>
                <li><strong>Backup:</strong> Sistema automatizado de backup e restore</li>
            </ul>
        </div>
        
        <div class="legend">
            <h3>📝 Observações Técnicas:</h3>
            <ul>
                <li>Modelo segue padrões de normalização de banco de dados (3NF)</li>
                <li>Suporte completo a sincronização distribuída entre mobile e desktop</li>
                <li>Otimizado para consultas frequentes do sistema financeiro</li>
                <li>Integridade referencial totalmente implementada com cascading</li>
                <li>Preparado para horizontal scaling com UUID como PK</li>
            </ul>
        </div>
    </div>
</body>
</html>